package com.gestionfacture;

import java.awt.*;
import javax.swing.*;
import java.sql.*;

public class LoginWindow extends JFrame {
    // Ajouter serialVersionUID pour éviter le warning
    private static final long serialVersionUID = 1L;

    // Créer les champs de texte comme variables globales
    private JTextField loginField;
    private JPasswordField passwordField;

    public LoginWindow() {
        // Définir la position et la taille de la fenêtre
        this.setBounds(100, 20, 400, 200);
        // Fermer l'application quand on clique sur la croix
        this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        // Donner un titre à la fenêtre
        this.setTitle("Connexion");

        // Créer les labels (étiquettes)
        JLabel l1 = new JLabel("Connexion Utilisateur");
        JLabel l2 = new JLabel("Login:");
        JLabel l3 = new JLabel("Mot de passe:");

        // Créer les champs de texte
        loginField = new JTextField(15);
        passwordField = new JPasswordField(15);

        // Créer le bouton
        JButton b1 = new JButton("Se connecter");

        // Créer des panneaux pour organiser les éléments
        JPanel p1 = new JPanel();
        p1.setLayout(new FlowLayout());
        p1.add(l1);

        JPanel p2 = new JPanel();
        p2.setLayout(new FlowLayout());
        p2.add(l2);

        JPanel p3 = new JPanel();
        p3.setLayout(new FlowLayout());
        p3.add(loginField);

        JPanel p4 = new JPanel();
        p4.setLayout(new FlowLayout());
        p4.add(l3);

        JPanel p5 = new JPanel();
        p5.setLayout(new FlowLayout());
        p5.add(passwordField);

        JPanel p6 = new JPanel();
        p6.setLayout(new FlowLayout());
        p6.add(b1);

        // Panneau pour organiser les champs (login et mot de passe)
        JPanel p7 = new JPanel();
        p7.setLayout(new GridLayout(2, 2));
        p7.add(p2);
        p7.add(p3);
        p7.add(p4);
        p7.add(p5);

        // Panneau principal qui contient tout
        JPanel p8 = new JPanel();
        p8.setLayout(new GridLayout(3, 1));
        p8.add(p1);
        p8.add(p7);
        p8.add(p6);

        // Ajouter le panneau principal à la fenêtre
        this.setLayout(new FlowLayout());
        this.add(p8);

        // Ajouter une action au bouton
        b1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                // Obtenir les valeurs des champs
                String login = loginField.getText();
                String password = new String(passwordField.getPassword());

                // Vérifier les informations dans la base de données
                try {
                    Connection conn = DatabaseConnection.getConnection();
                    // Vérifier si la connexion est null
                    if (conn == null) {
                        JOptionPane.showMessageDialog(null, "Erreur: Impossible de se connecter à la base de données!");
                        return;
                    }
                    String sql = "SELECT * FROM Utilisateur WHERE Login = ? AND Password = ?";
                    PreparedStatement pstmt = conn.prepareStatement(sql);
                    pstmt.setString(1, login);
                    pstmt.setString(2, password);
                    ResultSet rs = pstmt.executeQuery();

                    if (rs.next()) {
                        // Si la connexion réussit, ouvrir la fenêtre principale
                        JOptionPane.showMessageDialog(null, "Connexion réussie!");
                        dispose(); // Fermer la fenêtre de connexion
                        new MainWindow(); // Ouvrir la fenêtre principale
                    } else {
                        // Si la connexion échoue, afficher un message d'erreur
                        JOptionPane.showMessageDialog(null, "Login ou mot de passe incorrect!");
                    }

                    rs.close();
                    pstmt.close();
                    conn.close();
                } catch (SQLException ex) {
                    JOptionPane.showMessageDialog(null, "Erreur: " + ex.getMessage());
                }
            }
        });

        // Afficher la fenêtre
        this.show();
    }

    public static void main(String[] args) {
        new LoginWindow();
    }
}